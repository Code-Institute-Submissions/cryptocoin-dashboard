{% extends 'base.html' %}
{% block cryptoContent %}

<!-- Display Cards: Available cash and Profile Info -->
<section>
	<div class="row">
		<div class="col s12 m6 push-m6">
			<h3 class="header">Welcome, {{ user.profile.first_name }}</h3>
			<div class="card horizontal">
				<div class="card-image">
					<img src="https://lorempixel.com/100/150/abstract/6">
                        </div>
					<div class="card-stacked">
					<div class="card-content">
						<p>Name: {{ user.profile.first_name }} {{ user.profile.last_name }}</p>
						<p>Joined since: {{ user.profile.date_joined }} </p>
					</div>
					<div class="card-action">
						<a href="#">Update Your Profile</a>
					</div>
				</div>
			</div>
		</div>
		<div class="col s12 m6 pull-m6">
				<div class="card blue-grey darken-1">
					<div class="card-content white-text">
						<span class="card-title">Your Available Cash</span>
						<span class="card-title">{{ "US$ {:,.2f}".format(user.cash) }}</span>
						<div class="">
							<blockquote>Your available funds to purchase
								cryptocoins.<br>Add as much as you want, it's free!</blockquote>
						</div>
					</div>
					<div class="card-action">
						<a href="#">Add Funds</a>
					</div>
				</div>
		</div>
	</div>
</section>

<!-- Display Cards: Total balance and distribution graphs -->
<section>
    <div class="row">
        <div class="col s12 m6">
            <div class="card hoverable">
                <div class="card-content">
                    <h5 class="header">Your Balance</h5>
                    <h4>{{ "US$ {:,.2f}".format(balance.total|float) }} </h4>
                    <h5><span><i class="material-icons">trending_up</i></span> {{ "US$ {:,.2f}".format(balance.change|float) }} ({{ "{:,.2f}".format(balance.percentChange|float) }}%)</h5>
                </div>
                <div class="card-action">
                    <a href="#">History</a>
                    <a href="#">Distribution</a>
                </div>
            </div>
        </div>
        <div class="col s12 m6">
            <div class="card">
                <div class="card-image">
                    <div class="chart" id="balance-pie-chart">
                        <script>
                            var graphs = {{ plot | safe }};
                            Plotly.plot('balance-pie-chart',graphs,{});
                        </script>
                    </div>
                </div>
                <div class="card-content">
                    <a class="btn-floating halfway-fab waves-effect waves-light red"><i class="material-icons">add</i></a>
                    <span class="card-title">Balance Distribution</span>
                    <p>I am a very simple card. I am good at containing small bits of information. I am convenient because I require little markup to use effectively.</p>
                </div>
            </div>
        </div>
    </div>
</section>
<section>
    <div class="row">
        <div class="col s12 m6">
            <h4>My Crypto Wallet</h4>
            <ul class="collection">
            {% for coin_name, coin_info in wallet_coins.items() %}
                <li class="collection-item avatar card">
                    <img src="{{ url_for('static', filename='images/icons/'+ coin_name.replace('USDT','').lower() +'.png') }}" alt="Cryptocoin Icon" class="circle">
                    <span class="title">{{ coin_info['name'].replace('USD','') }} ({{ coin_info['symbol_short'] }})</span>
                    <h6>{{ coin_info['total_ticker'] }} {{ coin_info['symbol_short'] }}</h6>
                    <h5> {{ "US$ {:,.2f}".format(coin_info['balance']|float) }}</h5>
                    <blockquote>Change: {{ "US$ {:,.2f}".format(coin_info['value_change']|float) }} ({{ "{:,.2f}".format(coin_info['value_change_percent']|float) }}%) <br>Price: {{ "US$ {:,.2f}".format(coin_info['latestPrice']|float) }}</blockquote>
                    <span class="secondary-content"><i class="material-icons">trending_up</i></span>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn green darken-3">BUY</a>
                        <a class="waves-effect waves-light btn red darken-3">SELL</a>
                    </div>
                </li>
            {% endfor %}
            </ul>
        </div>
        <div class="col s12 m6">
            <h4>My Favorite Cryptocurrencies:</h4>
            {% if favorites %}
            <ul class="collection">
            {% for coin_name, coin_info in favorites.items() %}
                <li class="collection-item avatar card">
                    <img src="{{ url_for('static', filename='images/icons/'+ coin_name.replace('USDT','').lower() +'.png') }}" alt="Cryptocoin Icon" class="circle">
                    <span class="title">{{ coin_info['name'].replace('USD','') }} ({{coin_info['symbol_short']}})</span>
                    <blockquote>Price: {{ "US$ {:,.2f}".format(coin_info['latestPrice']|float) }}<br>
                                Bid price: {{ coin_info['bidPrice'] }} - Ask price: {{ coin_info['askPrice'] }}</blockquote>
                    <a href="/remove-fav/{{ user.username }}/{{ coin_info['symbol'] }}" class="secondary-content"><i class="material-icons">grade</i></a>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn green darken-3">BUY</a>
                    </div>
                </li>
            {% endfor %}
            </ul>
            {% else %}
            <div class="card blue-grey darken-1">
                <div class="card-content white-text">
                <span class="card-title">No Favorite Coins!</span>
                <p>Check the crytpcoin list down below and add them to your favorites list using the star symbol.</p>
                </div>
                <div class="card-action">
                <a href="#">This is a link</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col s12 m6">
            <h4>Latest Transactions</h4>
            {% if transactions %}
            <ul class="collection">
                {% for transaction in transactions %}
                <li class="collection-item avatar card">
                    <img src="{{ url_for('static', filename='images/icons/'+ transaction['symbol'].replace('USDT','').lower() +'.png') }}" alt="Cryptocoin Icon" class="circle">
                    <span class="title">{{ transaction['name'] }} ({{transaction['symbol'].replace('USDT','')}}) {{transaction['type'].capitalize() }}</span>
                    <h6>{{ transaction['ticker'] }} ({{transaction['symbol'].replace('USDT','')}})</h6>
                    <h5>Total: {{ "US$ {:,.2f}".format(transaction['ticker']*transaction['price']) }}</h5>
                    <blockquote>Date: {{ transaction['date'].strftime("%m/%d/%Y, %H:%M:%S") }}<br>Price: {{ "US$ {:,.2f}".format(transaction['price']) }}</blockquote>
                    <span class="secondary-content"><i class="material-icons">account_balance_wallet</i>
                    {% if transaction['type'] == 'purchase' %}
                        <i class="material-icons">keyboard_arrow_left</i>
                    {% elif transaction['type'] == 'sale' %}
                        <i class="material-icons">keyboard_arrow_right</i>
                    {% endif %}
                    </span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            {% endif %}
        </div>
        <div class="col s12 m6">
            {% if not_favorites %}
            <h4>Other Cryptocurrencies:</h4>
            <ul class="collection">
            {% for coin_name, coin_info in not_favorites.items() %}
                <li class="collection-item avatar card">
                    <img src="{{ url_for('static', filename='images/icons/'+ coin_name.replace('USDT','').lower() +'.png') }}" alt="Cryptocoin Icon" class="circle">
                    <span class="title">{{ coin_info['name'].replace('USD','') }} ({{coin_info['symbol_short']}})</span>
                    <blockquote>Price: {{ "US$ {:,.2f}".format(coin_info['latestPrice']|float) }}<br>
                                Bid price: {{ coin_info['bidPrice'] }} - Ask price: {{ coin_info['askPrice'] }}</blockquote>
                    <a href="/add-fav/{{ user.username }}/{{ coin_info['symbol'] }}" class="secondary-content"><i class="material-icons">library_add</i></a>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn green darken-3">BUY</a>
                    </div>
                </li>
            {% endfor %}
            </ul>
            {% else %}
            {% endif %}
        </div>
    </div>
    
</section>
{% endblock %}